<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include the Web3 library -->
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <!-- Include the jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Include your CSS file -->
    <link rel="stylesheet" href="./createWallet.css">
    <title>Create a Wallet - Blockchain Ticketing System</title>
</head>
<body>
    <div class="navigation">
        <a href="../homePage/index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
    </div>
    
    <h1><i class="fas fa-wallet"></i> Create a Wallet</h1>
    
    <div class="container">
        <p>Create a new Ethereum wallet for use with the Blockchain Ticketing System. You'll need to provide a password to encrypt your wallet keystore file.</p>
        
        <input type="password" id="password" placeholder="Enter a password for the Key Store">
        <button id="createWalletButton"><i class="fas fa-plus-circle"></i> Create Wallet</button>
        
        <label for="walletAddress">Wallet Address:</label>
        <textarea id="walletAddress" rows="2" cols="50" readonly></textarea>
        
        <label for="privateKey">Private Key:</label>
        <textarea id="privateKey" rows="2" cols="50" readonly></textarea>
        
        <label for="keystore">Keystore File:</label>
        <textarea id="keystore" rows="5" cols="50" readonly></textarea>
        
        <div style="margin-top: 20px; text-align: center;">
            <a class="btn" id="downloadKeystore" download="wallet.json"><i class="fas fa-download"></i> Download Keystore</a>
        </div>
    </div>

<script>
    $(document).ready(function(){
        $("#createWalletButton").click(function(){

             // alert if empty password
            var password = $("#password").val();
             if(password == ""){
                alert("Please enter a password for the Key Store");
                return;
            }
            // Create a new Web3 instance
            var web3 = new Web3();

            // Create a new wallet
            var wallet = web3.eth.accounts.create();
            // wallet address into the text area
            $("#walletAddress").val(wallet.address);

            // Display the private key
            $("#privateKey").val(wallet.privateKey);


            // Display the keystore file
            var keystore = web3.eth.accounts.encrypt(wallet.privateKey, password);
            $("#keystore").val(JSON.stringify(keystore));

        });
    });

    
    $("#downloadKeystore").click(function(){
            var keystore = $("#keystore").val();
            // alert if keystore is empty
            if(keystore == ""){
                alert("Please create a wallet first");
                return;
            }
            var blob = new Blob([keystore], {type: "text/plain;charset=utf-8"});
            var wallet = $("#walletAddress").val();
            saveAs(blob, wallet + ".json");
        });

    function saveAs(blob, filename) {
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
    }
</script>
</body>
</html>